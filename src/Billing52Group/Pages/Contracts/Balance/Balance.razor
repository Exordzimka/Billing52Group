@page "/contracts/{ContractId:int}/balance"
@using Microsoft.EntityFrameworkCore
@using Billing52Group.Configuration
@using Billing52Group.Models
@inject ApplicationDbContext Context
@attribute [Authorize]
@inject IJSRuntime JsRuntime


@if (_contractBalances != null)
{
    <ContractComponent Id="@ContractId"></ContractComponent>
    <h1 align="center">Balances</h1>
    <table class="table table-striped table-bordered table-hover">
        <thead>
        <tr align="center">
            <th>
                Year
            </th>
            <th>
                Month
            </th>
            <th>
                Summa
            </th>
        </tr>
        </thead>

        <tbody>
        @foreach (var contractBalance in _contractBalances)
        {
            <tr>
                <td>
                    @contractBalance.Yy
                </td>
                <td>
                    @contractBalance.Mm
                </td>
                <td>
                    @contractBalance.Summa
                </td>
            </tr>
        }
        </tbody>
    </table>
}

@code
{
    [Parameter]
    public int ContractId { get; set; }
    
    IEnumerable<ContractBalance> _contractBalances;
    protected override async Task OnInitializedAsync()
    {
        _contractBalances = await Context.ContractBalance.Where(contractBalance => contractBalance.ContractId == ContractId).ToListAsync();
    }

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        await base.OnAfterRenderAsync(firstRender);
    }
}